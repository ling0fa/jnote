[返回目录](../README.md)

### 内存溢出异常

- 虚拟机运行时的几个内存区域，除了程序计数器，其他区域都可能会内存溢出。

#### 1 堆内存溢出
- 为对象分配内存，内存不足且堆无法扩展时，出现内存溢出。`-XX:+HeapDumpOnOutOfMemoryError` 启动参数可以让虚拟机在内存溢出时 dump 内存快照，便于事后分析。
- 一般通过内存分析工具，如 Eclipse Memory Analyzer，来分析到底是内存泄漏还是内存溢出，如果是内存泄漏，可以查看对象到 GC Roots 的引用路径，就很容易分析出泄漏代码位置。

#### 2 虚拟机栈和本地方法栈溢出
- HotSpot 虚拟机将二者放在一起管理。
- 线程调用方法过深，会抛出 `StackOverflowError`，如果启用多线程，每个线程分配大量空间，也有可能会抛出 `OutOfMemoryError`。

#### 3 方法区和运行时常量池溢出
- 方法区保存过多 Class 信息溢出。随着动态加载 Class 技术的流行，比如 CGLib、OSGi、JSP 技术、运行在 JVM 上的动态语言，这种溢出会越来越常见。
- 常量池在 1.7 以前放在永久代，放多了会溢出，1.7 以后移除永久代，常量池的内容移到了堆中，同样放多了也会溢出。

#### 4 本机内存溢出
- `DirectMemory` 默认和 `-Xmx` 的大小一致。使用 `DirectMemory` 是通过计算发现内存不足，主动抛出的异常。
- 这种溢出的 dump 文件很小，且文件中看不出明显异常，可以考虑检查是不是直接或间接使用了 NIO。