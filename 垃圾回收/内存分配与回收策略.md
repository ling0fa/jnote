[返回目录](../README.md)

### 内存分配与回收策略

- **对象优先在 Eden 区分配**。Eden 区没有足够的空间，发起一次 Minor GC，新生代的 GC 发生次数多、速度快，且频繁。
- **大对象直接进入老年代**。这里的大对象是需要大量连续空间的对象，例如数组。大对象对 JVM 来说是坏消息，比大对象还坏的消息是遇到朝生夕灭的大对象，开发中应尽量避免。设置`-XX:PretenureSizeThreshold` 参数，令大于这个参数的对象直接进入老年代分配。
- **长期存活的对象将进入老年代**。每个对象有一个年龄，Minor GC 一次还存活，年龄加一，增加到一定阈值，默认是 15，就会被晋升到老年代，具体可以通过`-XX:MaxTenuringThreshold` 来设置。
- **动态年龄判断**。为了适应不同程序的状况，晋升阈值不一定非要达到才晋升。当某个年龄占了 Survivor 空间的一半以上，大于等于这个年龄的对象都可以进入老年代，不用等到晋升年龄阈值。
- **空间分配担保**。大意是，Minor GC 前，先检查老年代剩余连续空间是否比新生代的所有对象大，是的话说明老年代在极限情况下，可以容纳所有新生代对象，GC 是安全的。如果不成立，则检查老年代最大连续空间，是否大于历代晋升到老年代对象大小的平均值，如果大于，则尝试一次 Minor GC，否则 Full GC。