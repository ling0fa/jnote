[返回目录](../README.md)

### 类的加载过程 - 验证


- 除了 Java 语言，其他语言也可以编译成 Class 文件，所以校验就非常重要，避免对虚拟机造成危害。

- 验证步骤：
    - **文件格式验证**。验证字节流是否符合 Class 文件规范，包括**魔数、主次版本号、常量是否存在等等**。通过了这个验证后，字节流转化为方法区的存储结构，后续验证都基于这个结构，不再依赖字节流。
    - **元数据验证**。对字节码描述的信息进行**语义分析**，包括类是否有父类（除了 Object 没有）等等 Java 语言规范的元数据信息。主要针对类级别。
    - **字节码验证**。验证程序语义是否合法，主要针对类的方法，验证数据流和控制流是否合法。1.6 以后给方法的 Code 属性表增加了 StackMapTable 的属性，记录方法中本地变量表和操作栈状态，在字节码验证时，只需要验证 StackMapTable 即可，将字节码验证的类型推到转变为类型检查，进而可以节约一些时间。
    - **符号引用验证**。可以看做是对类自身以外（常量池中的各种符号引用）的信息进行匹配校验。

- 验证阶段是非常重要、但非必须的阶段。如果运行的全部代码，包括第三方代码都已经被反复验证过，在启动服务的时候，使用 `-Xverify:none` 来关闭大部分的类验证，缩短加载时间。
